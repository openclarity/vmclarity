# Configuration

## API server

| Environment Variable                        | Required                                               | Default        | Values                          | Description                                                                                                                                                                                                                                                                                                                                             |
| ------------------------------------------- | ------------------------------------------------------ | -------------- | ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `VMCLARITY_APISERVER_LISTEN_ADDRESS`        |                                                        | `0.0.0.0:8888` |                                 | Address of the _API Server_ to send requests to. Example: `localhost:8890`                                                                                                                                                                                                                                                                              |
| `VMCLARITY_APISERVER_HEALTHCHECK_ADDRESS`   |                                                        | `0.0.0.0:8081` |                                 | Bind address to used by the _API Server_ for `healthz` endpoint. Example: `localhost:8082` which will make the health endpoints be available at `localhost:8082/healthz/live` and `localhost:8082/healthz/ready`.                                                                                                                                       |
| `VMCLARITY_APISERVER_DATABASE_DRIVER`       | **yes**                                                | `LOCAL`        | `LOCAL`, `POSTGRES`             | Database driver type. `LOCAL` = SQLite, `POSTGRES` = PostgreSQL.                                                                                                                                                                                                                                                                                        |
| `VMCLARITY_APISERVER_DB_NAME`               | If `VMCLARITY_APISERVER_DATABASE_DRIVER` is `POSTGRES` |                |                                 | Database name.                                                                                                                                                                                                                                                                                                                                          |
| `VMCLARITY_APISERVER_DB_USER`               | If `VMCLARITY_APISERVER_DATABASE_DRIVER` is `POSTGRES` |                |                                 | Database user.                                                                                                                                                                                                                                                                                                                                          |
| `VMCLARITY_APISERVER_DB_PASS`               | If `VMCLARITY_APISERVER_DATABASE_DRIVER` is `POSTGRES` |                |                                 | Database user password.                                                                                                                                                                                                                                                                                                                                 |
| `VMCLARITY_APISERVER_DB_HOST`               | If `VMCLARITY_APISERVER_DATABASE_DRIVER` is `POSTGRES` |                |                                 | Database host, e.g. `postgresql`.                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_APISERVER_DB_PORT`               | If `VMCLARITY_APISERVER_DATABASE_DRIVER` is `POSTGRES` |                |                                 | Database port, e.g. `5432`.                                                                                                                                                                                                                                                                                                                             |
| `VMCLARITY_APISERVER_ENABLE_DB_INFO_LOGS`   |                                                        | `false`        |                                 | Boolean value whether to enable info logs of the database or not.                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_APISERVER_LOCAL_DB_PATH`         | If `VMCLARITY_APISERVER_DATABASE_DRIVER` is `LOCAL`    |                |                                 | Path of the database, if `LOCAL` is used as databse driver, e.g. `/data/vmclarity.db`.                                                                                                                                                                                                                                                                  |

## Orchestrator

| Environment Variable                                                        | Required | Default     | Values                          | Description                                                                                                                                                                                                                                                                                                                                           |
|-----------------------------------------------------------------------------| -------- | ----------- | ------------------------------- |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `VMCLARITY_ORCHESTRATOR_PROVIDER`                                           | **yes**  | `aws`       | `aws`, `azure`, `gcp`, `docker` | Provider used for _Asset_ discovery and scans.                                                                                                                                                                                                                                                                                                        |
| `VMCLARITY_ORCHESTRATOR_APISERVER_ADDRESS`                                  | **yes**  |             |                                 | The URL for the _API Server_ used by the _Orchestrator_ to interact with the API.  Example: `https://apiserver.example.com:8888/api`                                                                                                                                                                                                                  |
| `VMCLARITY_ORCHESTRATOR_HEALTHCHECK_ADDRESS`                                |          | `:8082`     |                                 | Bind address to used by the _Orchestrator_ for `healthz` endpoint. Example: `localhost:8082` which will make the health endpoints be available at `localhost:8082/healthz/live` and `localhost:8082/healthz/ready`.                                                                                                                                   |
| `VMCLARITY_ORCHESTRATOR_DISCOVERY_INTERVAL`                                 |          | `2m`        |                                 | How frequently the _Discovery_ perform discovery of _Assets_.                                                                                                                                                                                                                                                                                         |
| `VMCLARITY_ORCHESTRATOR_CONTROLLER_STARTUP_DELAY`                           |          | `7s`        |                                 | The time interval to wait between controller startups. **Do NOT change this parameter unless you know what you are doing.**                                                                                                                                                                                                                           |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_POLL_PERIOD`                      |          | `15s`       |                                 | How frequently poll the API for events related _AssetScan_ objects.                                                                                                                                                                                                                                                                                   |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_RECONCILE_TIMEOUT`                |          | `5m`        |                                 | Time period for reconciling a _AssetScan_ event is allowed to run.                                                                                                                                                                                                                                                                                    |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_ABORT_TIMEOUT`                    |          | `10m`       |                                 | Time period to wait for the _Scanner_ to gracefully stop on-going scan for _AssetScan_ before setting the state of the AssetScan to `Failed`.                                                                                                                                                                                                         |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_DELETE_POLICY`                    |          | `Always`    | `Always`, `Never`, `OnSuccess`  | Whether to delete resources (disk snapshot, container snapshot/images) or not based on the status of the _AssetScan_. `Always` means the _AssetScan_ is deleted no matter if it failed or not. `Never` skip cleaning up the resources created for scanning. `OnSuccess` means that cleanup is happening only iun case the _AssetScan_ was successful. |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_CONTAINER_IMAGE`          | **yes**  |             |                                 | The _Scanner_ container image used for running scans.                                                                                                                                                                                                                                                                                                 |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_FRESHCLAM_MIRROR`         |          |             |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_APISERVER_ADDRESS`        |          |             |                                 | The URL for the _API Server_ used by the _Scanner_ to interact with the API. Example: `https://apiserver.example.com:8888/api`                                                                                                                                                                                                                        |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_EXPLOITSDB_ADDRESS`       |          |             |                                 | The URL for the _ExploitsDB Server_ used by the _Scanner_.                                                                                                                                                                                                                                                                                            |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_TRIVY_SERVER_ADDRESS`     |          |             |                                 | The URL for the _Trivy Server_ used by the _Scanner_.                                                                                                                                                                                                                                                                                                 |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_TRIVY_SERVER_TIMEOUT`     |          | `5m`        |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_GRYPE_SERVER_ADDRESS`     |          |             |                                 | The URL for the _Grype Server_ used by the _Scanner_.                                                                                                                                                                                                                                                                                                 |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_GRYPE_SERVER_TIMEOUT`     |          | `2m`        |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_WATCHER_SCANNER_YARA_RULE_SERVER_ADDRESS` |          |             |                                 | The URL for the _Yara Rule Server_ used by the _Scanner_.                                                                                                                                                                                                                                                                                             |
| `VMCLARITY_ORCHESTRATOR_SCANCONFIG_WATCHER_POLL_PERIOD`                     |          |             |                                 | How frequently the _ScanConfig Watcher_ poll the API for events related _ScanConfig_ objects.                                                                                                                                                                                                                                                         |
| `VMCLARITY_ORCHESTRATOR_SCANCONFIG_WATCHER_RECONCILE_TIMEOUT`               |          |             |                                 | Time period which a reconciliation for a _ScanConfig_ event is allowed to run.                                                                                                                                                                                                                                                                        |
| `VMCLARITY_ORCHESTRATOR_SCAN_WATCHER_POLL_PERIOD`                           |          |             |                                 | How frequently the _AssetScan Watcher_ poll the API for events related _Scan_ objects.                                                                                                                                                                                                                                                                |
| `VMCLARITY_ORCHESTRATOR_SCAN_WATCHER_RECONCILE_TIMEOUT`                     |          |             |                                 | Time period for reconciling a _Scan_ event is allowed to run.                                                                                                                                                                                                                                                                                         |
| `VMCLARITY_ORCHESTRATOR_SCAN_WATCHER_SCAN_TIMEOUT`                          |          |             |                                 | Time period to wait for the _Scan_  finish before marked it's state as `Failed` with `Timeout` as a reason.                                                                                                                                                                                                                                           |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_PROCESSOR_POLL_PERIOD`                    |          |             |                                 | How frequently the _AssetScan Processor_ poll the API for events related _AssetScan_ objects.                                                                                                                                                                                                                                                         |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_PROCESSOR_RECONCILE_TIMEOUT`              |          |             |                                 | Time period for processing for a _AssetScan_ result is allowed to run.                                                                                                                                                                                                                                                                                |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_ESTIMATION_WATCHER_POLL_PERIOD`           |          | `5s`        |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_ASSETSCAN_ESTIMATION_WATCHER_RECONCILE_TIMEOUT`     |          | `15s`       |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_SCAN_ESTIMATION_WATCHER_POLL_PERIOD`                |          | `5s`        |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_SCAN_ESTIMATION_WATCHER_RECONCILE_TIMEOUT`          |          | `2m`        |                                 |                                                                                                                                                                                                                                                                                                                                                       |
| `VMCLARITY_ORCHESTRATOR_SCAN_ESTIMATION_WATCHER_ESTIMATION_TIMEOUT`         |          | `48h`       |                                 |                                                                                                                                                                                                                                                                                                                                                       |


## Provider

### AWS

| Environment Variable                   | Required | Default      | Description                                                                   |
|----------------------------------------|----------|--------------|-------------------------------------------------------------------------------|
| `VMCLARITY_AWS_REGION`                 | **yes**  |              | Region where the Scanner instance needs to be created                         |
| `VMCLARITY_AWS_SUBNET_ID`              | **yes**  |              | SubnetID where the Scanner instance needs to be created                       |
| `VMCLARITY_AWS_SECURITY_GROUP_ID`      | **yes**  |              | SecurityGroupId which needs to be attached to the Scanner instance            |
| `VMCLARITY_AWS_KEYPAIR_NAME`           |          |              | Name of the SSH KeyPair to use for Scanner instance launch                    |
| `VMCLARITY_AWS_SCANNER_AMI_ID`         | **yes**  |              | The AMI image used for creating Scanner instance                              |
| `VMCLARITY_AWS_SCANNER_INSTANCE_TYPE`  |          | `t2.large`   | The instance type used for Scanner instance                                   |
| `VMCLARITY_AWS_BLOCK_DEVICE_NAME`      |          | `xvdh`       | Block device name used for attaching Scanner volume to the Scanner instance   |

## UI backend

| Environment Variable                      | Required | Default        | Values                          | Description                                                                                                                                                                                                       |
|-------------------------------------------| -------- | -----------    | ------------------------------- |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `VMCLARITY_UIBACKEND_APISERVER_ADDRESS`   | **yes**  |                |                                 | The URL for the _API Server_ used by the _UI backend_ to interact with the API.  Example: `https://apiserver.example.com:8888/api`                                                                                |
| `VMCLARITY_UIBACKEND_LISTEN_ADDRESS`      |          | `0.0.0.0:8890` |                                 | Address of the _UI backend_ to send requests to. Example: `localhost:8890`                                                                                                                                        |
| `VMCLARITY_UIBACKEND_HEALTHCHECK_ADDRESS` |          | `0.0.0.0:8083` |                                 | Bind address to used by the _UI backend_ for `healthz` endpoint. Example: `localhost:8082` which will make the health endpoints be available at `localhost:8083/healthz/live` and `localhost:8083/healthz/ready`. |
