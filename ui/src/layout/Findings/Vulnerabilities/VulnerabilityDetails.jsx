import React from "react";
import { useLocation } from "react-router-dom";
import TabbedPage from "components/TabbedPage";
import FindingsDetailsPage from "../FindingsDetailsPage";
import TabVulnerabilityDetails from "./TabVulnerabilityDetails";
import AssetsForFindingTable from "layout/Assets/AssetsForFindingTable";

const VULNERABILITY_DETAILS_PATHS = {
  VULNERABILITY_DETAILS: "",
  ASSET_LIST: "assets",
};

const DetailsContent = ({ data }) => {
  const { pathname } = useLocation();

  const { id } = data;

  return (
    <TabbedPage
      basePath={`${pathname.substring(0, pathname.indexOf(id))}${id}`}
      items={[
        {
          id: "general",
          title: "Vulnerability details",
          isIndex: true,
          path: VULNERABILITY_DETAILS_PATHS.VULNERABILITY_DETAILS,
          component: () => <TabVulnerabilityDetails data={data} />,
        },
        {
          id: "assets",
          title: "Assets",
          path: VULNERABILITY_DETAILS_PATHS.ASSET_LIST,
          component: () => <AssetsForFindingTable findingId={id} />,
        },
      ]}
      withInnerPadding={false}
    />
  );
};

const VulnerabilityDetails = () => (
  <FindingsDetailsPage
    backTitle="Vulnerabilities"
    getTitleData={({ findingInfo }) => ({
      title: findingInfo.vulnerabilityName,
    })}
    detailsContent={DetailsContent}
  />
);

export default VulnerabilityDetails;
