openapi: 3.0.1

info:
  title: VMClarity APIs
  version: 1.0.0

servers:
  - url: /api

paths:
  /instances:
    get:
      summary: Get instances
      parameters:
        - name: page
          in: query
          description: Page number of the query
          required: true
          schema:
            type: integer
        - name: pageSize
          in: query
          description: Maximum items to return
          required: true
          schema:
            maximum: 50
            minimum: 1
            type: integer
        - name: sortKey
          in: query
          description: Sort key
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                required:
                  - total
                type: object
                properties:
                  total:
                    type: integer
                    description: Total instances count under the given filters
                  items:
                    type: array
                    description: List of instances in the given filters and page.
                      List length must be lower or equal to pageSize.
                    items:
                      $ref: '#/components/schemas/Instance'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      summary: Create instance
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceInfo'
        required: true
      responses:
        201:
          description: New instance was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceInfo'
        409:
          description: Instance already exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceInfo'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
      x-codegen-request-body-name: body

  /instances/{instanceID}:
    get:
      summary: Get instance.
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceInfo'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    put:
      summary: Update instance.
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceInfo'
        required: true
      responses:
        200:
          description: Update Instance successful.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceInfo'
        404:
          description: Instance not found.
          content: {}
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
      x-codegen-request-body-name: body
    delete:
      summary: Delete Instance.
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
      responses:
        204:
          description: Success
          content: {}
        404:
          description: Instance not found.
          content: {}
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults:
    get:
      summary: Get scan results for a specified instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          description: Page number of the query
          required: true
          schema:
            type: integer
        - name: pageSize
          in: query
          description: Maximum items to return
          required: true
          schema:
            maximum: 50
            minimum: 1
            type: integer
        - name: sortKey
          in: query
          description: Sort key
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                required:
                  - total
                type: object
                properties:
                  total:
                    type: integer
                    description: Total scan results count under the given filters
                  items:
                    type: array
                    description: List of scan results for a specified instance in the given filters and page.
                      List length must be lower or equal to pageSize.
                    items:
                      $ref: '#/components/schemas/ScanResults'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      summary: Create scan result for a specified instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScanResults'
        required: true
      responses:
        201:
          description: New results was added to the instance.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResults'
        409:
          description: Scan results already exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResults'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
      x-codegen-request-body-name: body

  /instances/{instanceID}/scanresults/{scanID}:
    get:
      summary: Report a specific scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResultsSummary'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    put:
      summary: Update scan results.
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScanResults'
        required: true
      responses:
        200:
          description: Update scan results successful.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScanResultsSummary'
        404:
          description: Scan ID not found.
          content: {}
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
      x-codegen-request-body-name: body

  /instances/{instanceID}/scanresults/{scanID}/sbom:
    get:
      summary: Get a specific sbom scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SbomScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults/{scanID}/vulnerabilities:
    get:
      summary: Get a specific vulnerabilities scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VulnerabilityScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults/{scanID}/malwares:
    get:
      summary: Get a specific malware scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MalwareScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults/{scanID}/secrets:
    get:
      summary: Get a specific secret scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults/{scanID}/rootkits:
    get:
      summary: Get a specific rootkit scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RootkitScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults/{scanID}/misconfiguration:
    get:
      summary: Get a specific misconfiguration scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MisconfigurationScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /instances/{instanceID}/scanresults/{scanID}/exploits:
    get:
      summary: Get a specific exploit scan result for a specific instance
      parameters:
        - name: instanceID
          in: path
          required: true
          schema:
            type: string
        - name: scanID
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExploitScan'
        default:
          description: unknown error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  schemas:
    ApiResponse:
      type: object
      properties:
        message:
          type: string
      description: An object that is returned in all cases of failures.

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
      description: An object that is returned in cases of success that returns nothing.

    CloudProvider:
      type: string
      enum:
        - AWS

    InstanceInfo:
      type: object
      properties:
        id:
          type: string
        instanceName:
          type: string
        instanceProvider:
          $ref: '#/components/schemas/CloudProvider'
        location:
          type: string

    Instance:
      type: object
      properties:
        id:
          type: string
        instance:
          $ref: '#/components/schemas/InstanceInfo'
        scanResults:
          type: integer
          format: uint32

    ScanResults:
      type: object
      properties:
        id:
          type: string
        sboms:
          $ref: '#/components/schemas/SbomScan'
        vulnerabilities:
          $ref: '#/components/schemas/VulnerabilityScan'
        malwares:
          $ref: '#/components/schemas/VulnerabilityScan'
        secrets:
          $ref: '#/components/schemas/SecretScan'
        misconfigurations:
          $ref: '#/components/schemas/MisconfigurationScan'
        exploits:
          $ref: '#/components/schemas/ExploitScan'

    ScanResultsSummary:
      type: object
      properties:
        packagesCount:
          type: integer
        vulnerabilitiesCount:
          type: integer
        malwaresCount:
          type: integer
        secretsCount:
          type: integer
        misconfigurationsCount:
          type: integer
        exploitsCount:
          type: integer

    PackageInfo:
      type: object
      properties:
        id:
          type: string
        packageName:
          type: string
        packageVersion:
          type: string

    VulnerabilityInfo:
      type: object
      properties:
        id:
          type: string
        vulnerabilityName:
          type: string
        description:
          type: string

    Package:
      type: object
      properties:
        id:
          type: string
        packageInfo:
          $ref: '#/components/schemas/PackageInfo'

    Vulnerability:
      type: object
      properties:
        id:
          type: string
        packageInfo:
          $ref: '#/components/schemas/VulnerabilityInfo'

    MalwareInfo:
      type: object
      properties:
        id:
          type: string
        malwareName:
          type: string
        malwareType:
          $ref: '#/components/schemas/MalwareType'
        path:
          type: string
          description: Path of the file that contains malware

    RootkitInfo:
      type: object
      properties:
        id:
          type: string
        rootkitName:
          type: string
        rootkitType:
          $ref: '#/components/schemas/RootkitType'
        path:
          type: string
          description: Path of the file that contains rootkit

    MisconfigurationInfo:
      type: object
      properties:
        id:
          type: string
        description:
          type: string
        path:
          type: string
          description: Path of the file that contains misconfigurations

    SecretInfo:
      type: object
      properties:
        id:
          type: string
        description:
          type: string
        path:
          type: string
          description: Path of the file that contains secrets

    ExploitInfo:
      type: object
      properties:
        id:
          type: string
        description:
          type: string
        vulnerabilities:
          type: array
          items:
            type: string

    SbomScan:
      type: object
      properties:
        packages:
          type: array
          items:
            $ref: '#/components/schemas/Package'

    VulnerabilityScan:
      type: object
      properties:
        vulnerabilities:
          type: array
          items:
            $ref: '#/components/schemas/Vulnerability'

    MalwareScan:
      type: object
      properties:
        packages:
          type: array
          items:
            $ref: '#/components/schemas/MalwareInfo'

    RootkitScan:
      type: object
      properties:
        packages:
          type: array
          items:
            $ref: '#/components/schemas/RootkitInfo'

    SecretScan:
      type: object
      properties:
        packages:
          type: array
          items:
            $ref: '#/components/schemas/SecretInfo'

    MisconfigurationScan:
      type: object
      properties:
        packages:
          type: array
          items:
            $ref: '#/components/schemas/MisconfigurationInfo'

    ExploitScan:
      type: object
      properties:
        packages:
          type: array
          items:
            $ref: '#/components/schemas/ExploitInfo'

    MalwareType:
      type: string
      enum:
        - ADWARE
        - VIRUS
        - TROJAN
        - WORM
        - SPYWARE
        - RANSOMWARE

    RootkitType:
      type: string
      enum:
        - MEMORY
        - KERNEL
        - APPLICATION
        - FIRMWARE

  responses:
    Success:
      description: success message
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessResponse'

    UnknownError:
      description: unknown error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'

  parameters:
    instanceID:
      name: instanceID
      in: path
      required: true
      schema:
        type: string

    scanID:
      name: scanID
      in: path
      required: true
      schema:
        type: string

    page:
      name: page
      in: query
      description: Page number of the query
      required: true
      schema:
        type: integer

    pageSize:
      name: pageSize
      in: query
      description: Maximum items to return
      required: true
      schema:
        maximum: 50
        minimum: 1
        type: integer